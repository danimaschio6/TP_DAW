<!-- src/app/components/responder-encuesta/responder-encuesta.component.html -->
<app-seccion>
  <div class="container">
    <div class="header">
      <h1>Responder Encuesta</h1>
    </div>

    <div *ngIf="cargando()" class="loading">
      <p>Cargando encuesta...</p>
    </div>

    <div *ngIf="!cargando() && encuesta()" class="survey-form">
      <h2>{{ encuesta()?.nombre }}</h2>
      
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div *ngFor="let pregunta of encuesta()?.preguntas" class="question-container">
          <h3>{{ pregunta.numero }}. {{ pregunta.texto }}</h3>
          
          <!-- Pregunta Abierta -->
          <div *ngIf="pregunta.tipo === TiposRespuestaEnum.ABIERTA" class="question-input">
            <p-floatlabel>
              <textarea 
                pTextarea 
                [formControlName]="'pregunta_' + pregunta.id"
                rows="3"
                cols="50">
              </textarea>
              <label>Tu respuesta</label>
            </p-floatlabel>
            <app-texto-error 
              [control]="form.get('pregunta_' + pregunta.id)!"
              mensaje="Esta pregunta es requerida">
            </app-texto-error>
          </div>

          <!-- Selección Simple -->
          <div *ngIf="pregunta.tipo === TiposRespuestaEnum.OPCION_MULTIPLE_SELECCION_SIMPLE" class="question-options">
            <div *ngFor="let opcion of pregunta.opciones" class="radio-option">
              <p-radioButton 
                [formControlName]="'pregunta_' + pregunta.id"
                [value]="opcion.id"
                [inputId]="'radio_' + pregunta.id + '_' + opcion.id">
              </p-radioButton>
              <label [for]="'radio_' + pregunta.id + '_' + opcion.id" class="option-label">
                {{ opcion.texto }}
              </label>
            </div>
            <app-texto-error 
              [control]="form.get('pregunta_' + pregunta.id)!"
              mensaje="Debes seleccionar una opción">
            </app-texto-error>
          </div>

          <!-- Selección Múltiple -->
          <div *ngIf="pregunta.tipo === TiposRespuestaEnum.OPCION_MULTIPLE_SELECCION_MULTIPLE" class="question-options">
            <div *ngFor="let opcion of pregunta.opciones" class="checkbox-option" 
                 [formGroup]="getPreguntaFormGroup(pregunta.id)">
              <p-checkbox 
                [formControlName]="'opcion_' + opcion.id"
                [inputId]="'check_' + pregunta.id + '_' + opcion.id">
              </p-checkbox>
              <label [for]="'check_' + pregunta.id + '_' + opcion.id" class="option-label">
                {{ opcion.texto }}
              </label>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            pButton 
            [disabled]="enviando()"
            [loading]="enviando()"
            class="submit-button">
            {{ enviando() ? 'Enviando...' : 'Enviar Respuesta' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</app-seccion>